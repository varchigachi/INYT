<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Smart Downloader</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: radial-gradient(circle at top right, #0f172a, #020617 70%);
  }
  .glass {
    backdrop-filter: blur(20px);
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.15);
  }
  select option { background: #0f172a; color: white; }
  .progress { transition: width 0.3s ease; }
  .glow {
    animation: glowPulse 2s ease-in-out infinite alternate;
  }
  @keyframes glowPulse {
    from { filter: drop-shadow(0 0 6px #00f2ff); }
    to { filter: drop-shadow(0 0 20px #00f2ff); }
  }
  @keyframes slideUpFade {
  0% { transform: translateY(20px); opacity: 0; }
  100% { transform: translateY(0); opacity: 1; }
}
.show-toast {
  display: block !important;
  animation: slideUpFade 0.6s ease-out forwards;
}
.hide-toast {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s ease, transform 0.5s ease;
}

</style>
</head>
<body class="text-white flex flex-col justify-center items-center min-h-screen">

  <!-- HEADER -->
  <h1 class="text-5xl font-extrabold bg-gradient-to-r from-blue-400 via-cyan-400 to-pink-500 bg-clip-text text-transparent mb-4">
    Smart Video & Audio Downloader
  </h1>
  <p class="text-gray-400 mb-10 text-center text-lg">
    üé¨ Download from YouTube ‚Ä¢ Shorts ‚Ä¢ Instagram in full HD or MP3
  </p>

  <!-- MAIN CARD -->
  <div class="glass p-8 rounded-2xl w-11/12 max-w-lg">
    <form id="form" class="space-y-5">
      <!-- URL Input -->
      <input id="url" name="url" placeholder="Paste YouTube / Instagram link..."
        class="w-full px-4 py-3 rounded-lg bg-black/50 text-white border border-white/20 focus:ring-4 focus:ring-cyan-400 outline-none" />

      <!-- Format dropdown -->
      <select id="format" name="format_id"
        class="w-full px-4 py-3 rounded-lg bg-black text-gray-200 border border-white/20 focus:ring-4 focus:ring-blue-500 outline-none">
        <option>Select format...</option>
      </select>

      <!-- Buttons -->
      <div class="flex space-x-3">
        <button type="submit" id="videoBtn"
          class="w-1/2 py-3 bg-gradient-to-r from-blue-600 via-cyan-400 to-pink-500 rounded-xl font-semibold hover:scale-[1.02] transition-all duration-300">
          üé• Download Video
        </button>
        <button type="button" id="audioBtn"
          class="w-1/2 py-3 bg-gradient-to-r from-pink-600 via-purple-400 to-red-500 rounded-xl font-semibold hover:scale-[1.02] transition-all duration-300">
          üéß Download Audio
        </button>
      </div>
    </form>

    <!-- Preview -->
    <div id="preview" class="hidden mt-6 text-center">
      <img id="thumb" class="mx-auto rounded-lg w-60 h-34 object-cover shadow-lg" />
      <h3 id="title" class="mt-3 text-lg font-semibold"></h3>
      <p id="platform" class="text-gray-400 text-sm"></p>
    </div>

    <!-- Progress Bar -->
    <div id="progressBox" class="hidden mt-6">
      <div class="w-full bg-white/10 h-3 rounded-full">
        <div id="bar" class="bg-gradient-to-r from-cyan-400 to-pink-500 h-3 rounded-full progress" style="width:0%"></div>
      </div>
      <p id="pct" class="text-center text-sm text-gray-400 mt-2">0%</p>
    </div>

    <!-- Message -->
    <div id="msg" class="mt-4 text-center text-lg font-medium"></div>
  </div>

  <!-- FOOTER -->
  <footer class="mt-12 text-gray-500 text-sm text-center">
    Built with ‚ù§Ô∏è by <span class="text-cyan-400">Srujan</span>
  </footer>

  <!-- SCRIPTS -->
  <script>
const form = document.querySelector("form");
const msg = document.getElementById("msg");
const bar = document.getElementById("bar");
const pct = document.getElementById("pct");
let currentFileId = null;

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  const url = form.querySelector("input").value.trim();
  if (!url) return;

  msg.innerHTML = "‚è≥ Fetching video info...";
  bar.style.width = "10%";

  const formData = new FormData();
  formData.append("url", url);

  try {
    const res = await fetch("/metadata", { method: "POST", body: formData });
    const data = await res.json();
    if (data.error) throw new Error(data.error);

    msg.innerHTML = `
      <div class="mt-3 text-white">
        <img src="${data.thumbnail}" class="rounded-xl mb-3 w-64">
        <h2 class="text-xl font-semibold">${data.title}</h2>
      </div>
      <div class="flex gap-2 mt-3">
        <button id="vidBtn" class="bg-blue-600 px-3 py-2 rounded-xl">üé• Video</button>
        <button id="audBtn" class="bg-green-600 px-3 py-2 rounded-xl">üéß Audio</button>
      </div>
    `;
    document.getElementById("vidBtn").onclick = () => startDownload(url, "video");
    document.getElementById("audBtn").onclick = () => startDownload(url, "audio");
  } catch (err) {
    msg.innerHTML = `<span class="text-red-400">‚ùå ${err.message}</span>`;
  }
});

async function startDownload(url, mode) {
  const formData = new FormData();
  formData.append("url", url);
  formData.append("mode", mode);

  currentFileId = Date.now().toString();
  bar.style.width = "0%";
  pct.textContent = "0%";
  msg.innerHTML = "üì• Downloading...";

  const pollProgress = async () => {
    if (!currentFileId) return;
    const res = await fetch(`/progress/${currentFileId}`);
    const percent = await res.text();
    bar.style.width = percent;
    pct.textContent = percent;
    if (percent === "100%") {
      showToast("‚úÖ Download Complete!");
      currentFileId = null;
    } else {
      setTimeout(pollProgress, 1000);
    }
  };
  setTimeout(pollProgress, 1000);

  try {
    const res = await fetch("/download", { method: "POST", body: formData });
    const blob = await res.blob();
    const urlBlob = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = urlBlob;
    a.download = `${mode === "audio" ? "audio.mp3" : "video.mp4"}`;
    a.click();
    URL.revokeObjectURL(urlBlob);
  } catch (err) {
    console.error(err);
    showToast("‚ùå Download failed", "error");
  }
}

// Toast
function showToast(text, type = "success") {
  const toast = document.createElement("div");
  toast.textContent = text;
  toast.className = "fixed bottom-6 right-6 px-5 py-3 rounded-xl text-lg shadow-lg z-50";
  toast.style.transition = "opacity 0.5s ease";
  toast.style.background = type === "error" ? "#ef4444" : "#22c55e";
  document.body.appendChild(toast);
  setTimeout(() => (toast.style.opacity = "0"), 2500);
  setTimeout(() => toast.remove(), 3000);
}
</script>


  <!-- ‚úÖ Toast Notification -->
    <div id="toast" class="hidden fixed bottom-6 right-6 bg-gradient-to-r from-cyan-500 via-blue-500 to-pink-500 
    text-white px-6 py-4 rounded-xl shadow-2xl font-semibold text-lg transform translate-y-20 opacity-0 
    transition-all duration-700 ease-out">
    ‚úÖ Download Complete!
    </div>
</body>
</html>
